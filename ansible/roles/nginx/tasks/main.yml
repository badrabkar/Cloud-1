---
# tasks file for nginx

- name: Create directories
  tags: [nginx,dirs]
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - "{{ansible_env.HOME}}/Inception/requirements/nginx/tools"
    # - "{{ansible_env.HOME}}/Inception/requirements/nginx/conf"
    
- name: copy dockerfile
  tags: [nginx,copy_nginx_dockerfile]
  copy:
    src: Dockerfile
    dest: "{{ansible_env.HOME}}/Inception/requirements/nginx/"

- name: copy script.sh
  tags: [nginx,copy_nginx_script]
  copy:
    src: script.sh
    dest: "{{ansible_env.HOME}}/Inception/requirements/nginx/tools"

# - name: copy nginx.conf
#   tags: [nginx,copy_nginx_conf]
#   copy:
#     src: nginx.conf
#     dest: "{{ansible_env.HOME}}/Inception/requirements/nginx/conf"

- name: build the image
  tags: [nginx,build_nginx_image]
  ansible.builtin.command: docker compose -f "{{ansible_env.HOME}}/Inception/docker-compose.yml" build  nginx

- name: start the nginx container
  tags: [nginx,start_nginx_container]
  ansible.builtin.command: docker compose -f "{{ansible_env.HOME}}/Inception/docker-compose.yml" up  -d nginx